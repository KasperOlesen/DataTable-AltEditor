!function(t){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],(function(e){return t(e,window,document)})):"object"==typeof exports?module.exports=function(e,a){return e||(e=window),a&&a.fn.dataTable||(a=require("datatables.net")(e,a).$),t(a,e,e.document)}:t(jQuery,window,document)}((function(t,e,a,o){"use strict";var i=t.fn.dataTable,n=0,r=function(e,a){if(!i.versionCheck||!i.versionCheck("1.10.8"))throw"Warning: altEditor requires DataTables 1.10.8 or greater";this.c=t.extend(!0,{},i.defaults.altEditor,r.defaults,a),this.s={dt:new i.Api(e),namespace:".altEditor"+n++},this.dom={modal:t('<div class="dt-altEditor-handle"/>')},this._constructor()};return t.extend(r.prototype,{_constructor:function(){var e=this,i=this.s.dt;i.settings()[0].oInit.onAddRow&&(e.onAddRow=i.settings()[0].oInit.onAddRow),i.settings()[0].oInit.onDeleteRow&&(e.onDeleteRow=i.settings()[0].oInit.onDeleteRow),i.settings()[0].oInit.onEditRow&&(e.onEditRow=i.settings()[0].oInit.onEditRow),e.closeModalOnSuccess=i.settings()[0].oInit.closeModalOnSuccess,e.closeModalOnSuccess===o&&(e.closeModalOnSuccess=!0),e.encodeFiles=i.settings()[0].oInit.encodeFiles,e.encodeFiles===o&&(e.encodeFiles=!0),this._setup(),i.on("destroy.altEditor",(function(){i.off(".altEditor"),t(i.table().body()).off(e.s.namespace),t(a.body).off(e.s.namespace)}))},_setup:function(){var e=this,a=this.s.dt;this.random_id=(""+Math.random()).replace(".","");var o="altEditor-modal-"+this.random_id;this.modal_selector="#"+o,this.language=a.settings()[0].oLanguage.altEditor||{},this.language.modalClose=this.language.modalClose||"Close",this.language.edit=this.language.edit||{},this.language.edit={title:this.language.edit.title||"Edit record",button:this.language.edit.button||"Edit"},this.language.delete=this.language.delete||{},this.language.delete={title:this.language.delete.title||"Delete record",button:this.language.delete.button||"Delete"},this.language.add=this.language.add||{},this.language.add={title:this.language.add.title||"Add record",button:this.language.add.button||"Add"},this.language.success=this.language.success||"Success!",this.language.error=this.language.error||{},this.language.error={message:this.language.error.message||"There was an unknown error!",label:this.language.error.label||"Error!",responseCode:this.language.error.responseCode||"Response code: ",required:this.language.error.required||"Field is required",unique:this.language.error.unique||"Duplicated field"};var i='<div class="modal fade altEditor-modal reveal" id="'+o+'" tabindex="-1" role="dialog" data-reveal><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 style="padding-top: 1rem;padding-left: 1rem;" class="modal-title"></h4><button style="margin: initial;" type="button" class="close close-button" data-dismiss="modal" data-close aria-label="'+this.language.modalClose+'"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"><p></p></div><div class="modal-footer"></div></div></div></div>';t("body").append(i),a.button("edit:name")&&a.button("edit:name").action((function(a,o,i,n){e._openEditModal(),t("#altEditor-edit-form-"+e.random_id).off("submit").on("submit",(function(t){t.preventDefault(),t.stopPropagation(),e._editRowData()}))})),a.button("delete:name")&&a.button("delete:name").action((function(a,o,i,n){e._openDeleteModal(),t("#altEditor-delete-form-"+e.random_id).off("submit").on("submit",(function(t){t.preventDefault(),t.stopPropagation(),e._deleteRow()}))})),a.button("add:name")&&a.button("add:name").action((function(a,o,i,n){e._openAddModal(),t("#altEditor-add-form-"+e.random_id).off("submit").on("submit",(function(t){t.preventDefault(),t.stopPropagation(),e._addRowData()}))})),t(this.modal_selector).bind("input","[data-unique]",(function(o){if(null!=t(o.target).attr("data-unique")&&"false"!==t(o.target).attr("data-unique")){var i=t(o.target),n=a.column("th:contains('"+i.attr("name")+"')").data(),r=null;for(var l in null!=a.row({selected:!0}).index()&&(r=a.cell(a.row({selected:!0}).index(),a.column("th:contains('"+i.attr("name")+"')").index()).data()),o.target.setCustomValidity(""),n)i.val()==n[l]&&n[l]!=r&&o.target.setCustomValidity(e.language.error.unique)}})),this.s.dt.button("refresh:name")&&this.s.dt.button("refresh:name").action((function(t,e,a,o){e.ajax&&e.ajax.url()&&e.ajax.reload()}))},_emitEvent:function(e,a){this.s.dt.iterator("table",(function(o,i){t(o.nTable).triggerHandler(e+".dt",a)}))},_openEditModal:function(){var e=this.s.dt.rows({selected:!0}),a=this.completeColumnDefs(),o=(this.createDialog(a,this.language.edit.title,this.language.edit.button,this.language.modalClose,"editRowBtn","altEditor-edit-form"),this.modal_selector);for(var i in a)if(null!=a[i].name){for(var n=a[i].name.toString().split("."),r=e.data()[0],l=0;l<n.length;l++)r&&(r=r[n[l]]);var d="#"+a[i].name.toString().replace(/\./g,"\\.");if(t(o).find(d).val(r),t(o).find(d).trigger("change"),a[i].type.indexOf("checkbox")>=0&&"true"===this._quoteattr(r)&&t(o).find(d).prop("checked",this._quoteattr(r)),a[i].type.indexOf("date")>=0&&""!==a[i].dateFormat){var s=moment(this._quoteattr(r));s&&s.isValid()&&t(o).find(d).val(s.format(a[i].dateFormat))}}t(o+" input[0]").trigger("focus"),t(o).trigger("alteditor:some_dialog_opened").trigger("alteditor:edit_dialog_opened")},_editRowData:function(){var e=this,a=this.s.dt,o={};a.rows({selected:!0});t('form[name="altEditor-edit-form-'+this.random_id+'"] *').filter(':input[type!="file"]').each((function(e){o[t(this).attr("id")]=t(this).val()})),t('form[name="altEditor-edit-form-'+this.random_id+'"] *').filter("textarea").each((function(e){o[t(this).attr("id")]=t(this).val()}));var i=0;t('form[name="altEditor-edit-form-'+this.random_id+'"] *').filter(':input[type="file"]').each((function(a){t(this).prop("files")[0]&&(e.encodeFiles?(++i,e.getBase64(t(this).prop("files")[0],(function(e){o[t(this).attr("id")]=e,--i}))):o[t(this).attr("id")]=t(this).prop("files")[0])})),t('form[name="altEditor-edit-form-'+this.random_id+'"] *').filter(':input[type="checkbox"]').each((function(e){o[t(this).attr("id")]=this.checked}));var n=function(){0==i?e.onEditRow(e,o,(function(t,a,o,i,n){e._editRowCallback(t,a,o,i,n)}),(function(t){e._errorCallback(t)})):setTimeout(n,1e3)};n()},_openDeleteModal:function(){var e=this,a=this.s.dt.rows({selected:!0}),i=this.completeColumnDefs(),n="altEditor-delete-form-"+this.random_id,r="";for(var l in i)if(null!=i[l].name)if(i[l].type.indexOf("hidden")>=0)r+="<input type='hidden' id='"+i[l].title+"' value='"+a.data()[0][i[l].name]+"'></input>";else if(i[l].type.indexOf("file")<0){for(var d=i[l].name.toString().split("."),s=a.data()[0],u=0;u<d.length;u++)s&&(s=s[d[u]]);if(i[l].type.indexOf("date")>=0&&""!==i[l].dateFormat){var c=moment(a.data()[0][i[l].name]);c&&c.isValid()&&(s=c.format(i[l].dateFormat))}if(i[l].type.indexOf("select")>=0){var m=i[l].options,f=function(t){return m.length===o?t in m?m[t]:null:t};if(s instanceof Array){var p=s.map(f).filter((function(t){return null!=t}));s=p.join(", ")}else s=f(s)}r+="<div style='margin-left: initial;margin-right: initial;' class='form-group row'><label for='"+e._quoteattr(i[l].name)+"'>"+i[l].title+":&nbsp</label> <input  type='hidden'  id='"+e._quoteattr(i[l].title)+"' name='"+e._quoteattr(i[l].title)+"' placeholder='"+e._quoteattr(i[l].title)+"' style='overflow:hidden'  class='form-control' value='"+e._quoteattr(s)+"' >"+s+"</input></div>"}var h=this.modal_selector;this.internalOpenDialog(h,(function(){var a='<button type="button" data-content="remove" class="btn btn-default button secondary" data-close data-dismiss="modal">'+e.language.modalClose+'</button><button type="submit"  data-content="remove" class="btn btn-danger button" id="deleteRowBtn">'+e.language.delete.button+"</button>";t(h).find(".modal-title").html(e.language.delete.title),t(h).find(".modal-body").html(r),t(h).find(".modal-footer").html(a);var o=t(h).find(".modal-content");o.parent().is("form")?(o.parent().attr("name",n),o.parent().attr("id",n)):o.wrap("<form name='"+n+"' id='"+n+"' role='form'></form>")})),t(h+" input[0]").trigger("focus"),t(h).trigger("alteditor:some_dialog_opened").trigger("alteditor:delete_dialog_opened")},_deleteRow:function(){for(var t=this,e=this.s.dt,a={},o=e.rows({selected:!0}),i=0;i<e.context[0].aoColumns.length;i++){var n=e.context[0].aoColumns[i].data?e.context[0].aoColumns[i].data:e.context[0].aoColumns[i].mData?e.context[0].aoColumns[i].mData:e.context[0].aoColumns[i].idx;a[n]=o.data()[0][n]}t.onDeleteRow(t,a,(function(e){t._deleteRowCallback(e)}),(function(e){t._errorCallback(e)}))},_openAddModal:function(){this.s.dt;var e=this.completeColumnDefs(),a=(this.createDialog(e,this.language.add.title,this.language.add.button,this.language.modalClose,"addRowBtn","altEditor-add-form"),this.modal_selector);t(a+" input[0]").trigger("focus"),t(a).trigger("alteditor:some_dialog_opened").trigger("alteditor:add_dialog_opened")},completeColumnDefs:function(){var t=[],e=this.s.dt;for(var a in e.context[0].aoColumns){var o=e.context[0].aoColumns[a];t[a]={title:o.sTitle,name:o.data?o.data:o.mData,type:o.type?o.type:"text",rows:o.rows?o.rows:"5",cols:o.cols?o.cols:"30",options:o.options?o.options:[],readonly:!!o.readonly&&o.readonly,disabled:!!o.disabled&&o.disabled,required:!!o.required&&o.required,msg:o.errorMsg?o.errorMsg:"",hoverMsg:o.hoverMsg?o.hoverMsg:"",pattern:o.pattern?o.pattern:".*",special:o.special?o.special:"",unique:!!o.unique&&o.unique,uniqueMsg:o.uniqueMsg?o.uniqueMsg:"",maxLength:!!o.maxLength&&o.maxLength,multiple:!!o.multiple&&o.multiple,select2:!!o.select2&&o.select2,datepicker:!!o.datepicker&&o.datepicker,datetimepicker:!!o.datetimepicker&&o.datetimepicker,editorOnChange:o.editorOnChange?o.editorOnChange:null,style:o.style?o.style:"",dateFormat:o.dateFormat?o.dateFormat:"",optionsSortByLabel:!!o.optionsSortByLabel&&o.optionsSortByLabel}}return t},createDialog:function(e,a,o,i,n,r){r=[r,this.random_id].join("-");var l="";for(var d in e)if(e[d].type.indexOf("hidden")>=0)l+="<input type='hidden' id='"+e[d].name+"' ></input>";else{if(l+="<div style='margin-left: initial;margin-right: initial;' class='form-group row' id='alteditor-row-"+this._quoteattr(e[d].name)+"'>",l+="<div class='col-sm-3 col-md-3 col-lg-3 text-right' style='padding-top:4px;'>",l+="<label for='"+e[d].name+"'>"+e[d].title+":</label></div>",l+="<div class='col-sm-8 col-md-8 col-lg-8'>",e[d].type.indexOf("readonly")>=0)l+="<input type='text' readonly  id='"+this._quoteattr(e[d].name)+"' name='"+this._quoteattr(e[d].title)+"' placeholder='"+this._quoteattr(e[d].title)+"' style='overflow:hidden'  class='form-control  form-control-sm' value=''>";else if(e[d].type.indexOf("select")>=0){var s="",u=e[d].options;if(u.length>0)for(var c=0;c<u.length;c++)s+="<option value='"+this._quoteattr(u[c])+"'>"+u[c]+"</option>";else for(var m in u)s+="<option value='"+this._quoteattr(m)+"' >"+u[m]+"</option>";l+="<select class='form-control"+(e[d].select2?" select2":"")+"' id='"+this._quoteattr(e[d].name)+"' name='"+this._quoteattr(e[d].title)+"' placeholder='"+this._quoteattr(e[d].title)+"' data-special='"+this._quoteattr(e[d].special)+"' data-errorMsg='"+this._quoteattr(e[d].msg)+"' data-uniqueMsg='"+this._quoteattr(e[d].uniqueMsg)+"' data-unique='"+e[d].unique+"' "+(e[d].readonly?" readonly ":"")+(e[d].disabled?" disabled ":"")+(e[d].required?" required ":"")+(e[d].multiple?" multiple ":"")+">"+s+"</select>"}else e[d].type.indexOf("textarea")>=0?l+="<textarea class='form-control' id='"+this._quoteattr(e[d].name)+"' name='"+this._quoteattr(e[d].title)+"' rows='"+this._quoteattr(e[d].rows)+"' cols='"+this._quoteattr(e[d].cols)+"' placeholder='"+this._quoteattr(e[d].title)+"' data-special='"+this._quoteattr(e[d].special)+"' data-errorMsg='"+this._quoteattr(e[d].msg)+"' data-uniqueMsg='"+this._quoteattr(e[d].uniqueMsg)+"' data-unique='"+e[d].unique+"' "+(e[d].readonly?" readonly ":"")+(e[d].disabled?" disabled ":"")+(e[d].required?" required ":"")+(0==e[d].maxLength?"":" maxlength='"+e[d].maxLength+"'")+" style='"+this._quoteattr(e[d].style)+"'></textarea>":l+="<input class='form-control' type='"+this._quoteattr(e[d].type)+"' id='"+this._quoteattr(e[d].name)+"' pattern='"+this._quoteattr(e[d].pattern)+"' title='"+this._quoteattr(e[d].hoverMsg)+"' name='"+this._quoteattr(e[d].title)+"' placeholder='"+this._quoteattr(e[d].title)+"' data-special='"+this._quoteattr(e[d].special)+"' data-errorMsg='"+this._quoteattr(e[d].msg)+"' data-uniqueMsg='"+this._quoteattr(e[d].uniqueMsg)+"' data-unique='"+e[d].unique+"' "+(e[d].readonly?" readonly ":"")+(e[d].disabled?" disabled ":"")+(e[d].required?" required ":"")+(0==e[d].maxLength?"":" maxlength='"+e[d].maxLength+"'")+" style='overflow:hidden;"+this._quoteattr(e[d].style)+"' class='form-control  form-control-sm' value=''>";l+="<label id='"+this._quoteattr(e[d].name)+"label' class='errorLabel'></label>",l+="</div><div style='clear:both;'></div></div>"}var f=this.modal_selector;this.internalOpenDialog(f,(function(){var e='<button type="button" data-content="remove" class="btn btn-default button secondary" data-dismiss="modal" data-close>'+i+'</button><button type="submit" form="'+r+'" data-content="remove" class="btn btn-primary button" id="'+n+'">'+o+"</button>";t(f).find(".modal-title").html(a),t(f).find(".modal-body").html(l),t(f).find(".modal-footer").html(e);var d=t(f).find(".modal-content");d.parent().is("form")?(d.parent().attr("name",r),d.parent().attr("id",r)):d.wrap("<form name='"+r+"' id='"+r+"' role='form'></form>")})),t(f+" input[0]").trigger("focus");var p=this;for(var d in e)if(e[d].select2?t(f).find("select#"+e[d].name).select2(e[d].select2):e[d].datepicker?t(f).find("#"+e[d].name).datepicker(e[d].datepicker):e[d].datetimepicker&&t(f).find("#"+e[d].name).datetimepicker(e[d].datetimepicker),e[d].editorOnChange&&(t(f).find("#"+t.escapeSelector(e[d].name)).attr("alt-editor-id",this._quoteattr(d)),t(f).find("#"+e[d].name).on("change",(function(a){(0,e[t(this).attr("alt-editor-id")].editorOnChange)(a,p)}))),e[d].type.indexOf("select")>=0&&e[d].optionsSortByLabel){var h="#"+e[d].name.toString().replace(/\./g,"\\."),g=t(f).find(h).find("option");g.sort((function(e,a){return t(e).text()>t(a).text()?1:-1})),t(f).find(h).html("").append(g),t(f).find(h).val(t(h+" option:first").val())}},_addRowData:function(){var e=this,a=(this.s.dt,{});t('form[name="altEditor-add-form-'+this.random_id+'"] *').filter(':input[type!="file"]').each((function(e){a[t(this).attr("id")]=t(this).val()})),t('form[name="altEditor-add-form-'+this.random_id+'"] *').filter("textarea").each((function(e){a[t(this).attr("id")]=t(this).val()}));var o=0;t('form[name="altEditor-add-form-'+this.random_id+'"] *').filter(':input[type="file"]').each((function(i){t(this).prop("files")[0]&&(e.encodeFiles?(++o,e.getBase64(t(this).prop("files")[0],(function(e){a[t(this).attr("id")]=e,--o}))):a[t(this).attr("id")]=t(this).prop("files")[0])})),t('form[name="altEditor-add-form-'+this.random_id+'"] *').filter(':input[type="checkbox"]').each((function(e){a[t(this).attr("id")]=this.checked}));var i=function(){0==o?e.onAddRow(e,a,(function(t){e._addRowCallback(t)}),(function(t){e._errorCallback(t)})):setTimeout(i,1e3)};i()},_deleteRowCallback:function(e,a,o){var i=this.modal_selector;if(t(i+" .modal-body .alert").remove(),this.closeModalOnSuccess)this.internalCloseDialog(i);else{var n='<div class="alert alert-success" role="alert"><strong>'+this.language.success+"</strong></div>";t(i+" .modal-body").append(n)}this.s.dt.row({selected:!0}).remove(),this.s.dt.draw("page"),t("div"+i).find("button#addRowBtn").prop("disabled",!0),t("div"+i).find("button#editRowBtn").prop("disabled",!0),t("div"+i).find("button#deleteRowBtn").prop("disabled",!0)},_addRowCallback:function(e,a,o){var i="string"==typeof e?JSON.parse(e):e,n=this.modal_selector;if(t(n+" .modal-body .alert").remove(),this.closeModalOnSuccess)this.internalCloseDialog(n);else{var r='<div class="alert alert-success" role="alert"><strong>'+this.language.success+"</strong></div>";t(n+" .modal-body").append(r)}this.s.dt.row.add(i).draw(!1),t("div"+n).find("button#addRowBtn").prop("disabled",!0),t("div"+n).find("button#editRowBtn").prop("disabled",!0),t("div"+n).find("button#deleteRowBtn").prop("disabled",!0)},_editRowCallback:function(e,a,o){var i="string"==typeof e?JSON.parse(e):e,n=this.modal_selector;if(t(n+" .modal-body .alert").remove(),this.closeModalOnSuccess)this.internalCloseDialog(n);else{var r='<div class="alert alert-success" role="alert"><strong>'+this.language.success+"</strong></div>";t(n+" .modal-body").append(r)}this.s.dt.row({selected:!0}).data(i),this.s.dt.draw("page"),t("div"+n).find("button#addRowBtn").prop("disabled",!0),t("div"+n).find("button#editRowBtn").prop("disabled",!0),t("div"+n).find("button#deleteRowBtn").prop("disabled",!0)},_errorCallback:function(e,a,o){var i=e,n=this.modal_selector;t(n+" .modal-body .alert").remove();var r=this.language.error.message;if(i.responseJSON&&i.responseJSON.errors)for(var l in r="",i.responseJSON.errors)r+=i.responseJSON.errors[l][0];var d='<div class="alert alert-danger" role="alert"><strong>'+this.language.error.label+"</strong> "+(null==i.status?"":this.language.error.responseCode+i.status)+" "+r+"</div>";t(n+" .modal-body").append(d)},onAddRow:function(t,e,a,o){a(e)},onEditRow:function(t,e,a,o){a(e)},onDeleteRow:function(t,e,a,o){a(e)},internalOpenDialog(e,a){var o=t(e);if(o.modal)o.on("show.bs.modal",a),o.modal("show");else{if(!o.foundation)return;o.on("open.zf.reveal",a),o.on("closed.zf.reveal",(function(){t(".reveal-overlay").hide()})),new Foundation.Reveal(o).open()}},internalCloseDialog(e){var a=t(e);if(a.modal)a.modal("hide");else{if(!a.foundation)return;new Foundation.Reveal(a).close(),t(".reveal-overlay").hide()}},reloadOptions:function(e,a){var o=e.val();e.empty(),a.length>0?t.each(a,(function(a,o){e.append(t("<option></option>").attr("value",o).text(o))})):t.each(a,(function(a,o){e.append(t("<option></option>").attr("value",o).text(a))})),e.val(o),e.trigger("change")},getBase64:function(t,e,a){var o=new FileReader;o.readAsDataURL(t),o.onload=function(){e&&e(o.result)},o.onerror=function(t){a&&a(t)}},_quoteattr:function(t,e){if(null==t)return"";if(e=e?"&#13;":"\n",Array.isArray(t)){var a,o=[];for(a in t)o.push(t[a]);return o}return(""+t).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,e).replace(/[\r\n]/g,e)}}),r.version="2.0",r.defaults={alwaysAsk:!1,focus:null,columns:"",update:null,editor:null},r.classes={btn:"btn"},t(a).on("preInit.dt.altEditor",(function(e,a,o){if("dt"===e.namespace){var n=a.oInit.altEditor,l=i.defaults.altEditor;if(n||l){var d=t.extend({},n,l);if(!1!==n){var s=new r(a,d);e.target.altEditor=s}}}})),i.altEditor=r,r}));